services:
  # Aplicaci√≥n Feniz
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Build-time environment variables (needed for Next.js build)
        DATABASE_URL: ${DATABASE_URL:?}
        BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET:?}
        GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID:?}
        GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET:?}
        JWT_SECRET: ${JWT_SECRET:?}
        NODEMAILER_USER: ${NODEMAILER_USER:?}
        NODEMAILER_PASSWORD: ${NODEMAILER_PASSWORD:?}
        NODEMAILER_SMTP: ${NODEMAILER_SMTP:?}
        NODEMAILER_PORT: ${NODEMAILER_PORT:?587}
        NEXT_PUBLIC_API_URL: ${SERVICE_FQDN_APP}
        NEXTAUTH_URL: ${SERVICE_FQDN_APP}
    restart: unless-stopped
    labels:
      - coolify.managed=true
      - traefik.enable=true
      - "traefik.http.routers.app.rule=Host(`${SERVICE_FQDN_APP}`)"
      - traefik.http.routers.app.entryPoints=http
      - traefik.http.services.app.loadbalancer.server.port=3000
    environment:
      # Required environment variables for database and authentication
      - DATABASE_URL=${DATABASE_URL:?}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET:?}
      
      # Google OAuth configuration (required)
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID:?}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET:?}
      
      # JWT and security
      - JWT_SECRET=${JWT_SECRET:?}
      
      # Email configuration (required for notifications)
      - NODEMAILER_USER=${NODEMAILER_USER:?}
      - NODEMAILER_PASSWORD=${NODEMAILER_PASSWORD:?}
      - NODEMAILER_SMTP=${NODEMAILER_SMTP:?}
      - NODEMAILER_PORT=${NODEMAILER_PORT:?587}
      
      # Application URLs (will use Coolify's FQDN)
      - NEXT_PUBLIC_API_URL=${SERVICE_FQDN_APP}
      - NEXTAUTH_URL=${SERVICE_FQDN_APP}
      - SERVICE_FQDN_APP=${SERVICE_FQDN_APP}
      
      # Environment
      - NODE_ENV=production
